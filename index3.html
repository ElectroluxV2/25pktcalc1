<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dietetyczny Detektyw â€“ Etap II (C++)</title>
    <style>
        :root { color-scheme: light dark; }

        html, body {
            height: 100vh;
            margin: 0;
            background-color: light-dark(#f8f9fa, #121212);
            color: light-dark(#222, #eee);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: light-dark(#1a5276, #5dade2);
            font-size: 1.5em;
            margin: 10px 0 12px;
        }

        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 20px;
            box-sizing: border-box;
            gap: 20px;
        }

        .table-wrapper {
            flex: 3;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: light-dark(#fff, #1a1a1a);
            font-size: 0.9em;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            border: 1px solid light-dark(#ccc, #333);
            padding: 5px 7px;
            vertical-align: top;
        }

        th {
            background-color: light-dark(#e9ecef, #252525);
        }

        td:first-child {
            width: 34%;
            font-weight: bold;
        }

        label {
            display: block;
            margin: 2px 0;
            line-height: 1.25em;
        }

        input[type="checkbox"] {
            transform: scale(0.9);
            margin-right: 6px;
        }

        .side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 14px;
        }

        .penalty-section, .summary {
            border-radius: 6px;
            padding: 10px 12px;
        }

        .penalty-section {
            background-color: light-dark(#fdecea, #2e1511);
            border-left: 5px solid light-dark(#c0392b, #e74c3c);
            font-size: 0.9em;
        }

        .penalty-section h3 {
            margin: 0 0 4px 0;
            color: light-dark(#922b21, #e57373);
            font-size: 0.95em;
            text-align: center;
        }

        .strike-boxes {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .summary {
            background-color: light-dark(#f1f8f5, #14281d);
            border-left: 5px solid light-dark(#2e7d32, #1abc9c);
            text-align: center;
            font-size: 0.95em;
        }

        .total {
            font-weight: bold;
            color: light-dark(#145a32, #58d68d);
            margin-bottom: 8px;
        }

        #timer {
            margin-bottom: 8px;
            font-family: monospace;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        button {
            background-color: light-dark(#1a5276, #16a085);
            color: light-dark(#fff, #000);
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.9em;
        }

        button:hover {
            background-color: light-dark(#154360, #149174);
        }
    </style>
</head>

<body>
<h1>Dietetyczny Detektyw â€“ Etap II (C++)</h1>

<main>
    <div class="table-wrapper">
        <table id="pointsTable">
            <tr><th>Kategoria</th><th>Wymagania (Å‚Ä…czna suma = 45 pkt)</th></tr>

            <tr>
                <td>1. Dynamiczna Alokacja Danych â€“ 10 pkt</td>
                <td>
                    <label><input type="checkbox" data-weight="2" /> Struktury Dnia i PosiÅ‚ku (poprawna definicja)</label>
                    <label><input type="checkbox" data-weight="2" /> Dynamiczna tablica struktur Dnia (rozmiar od uÅ¼ytkownika)</label>
                    <label><input type="checkbox" data-weight="3" /> Funkcja dodawania posiÅ‚ku na koniec listy</label>
                    <label><input type="checkbox" data-weight="3" /> Poprawna alokacja na stercie (new)</label>
                </td>
            </tr>

            <tr>
                <td>2. Arytmetyka WskaÅºnikÃ³w â€“ 10 pkt</td>
                <td>
                    <label><input type="checkbox" data-weight="4" /> Obliczanie sumy kalorii dla dnia</label>
                    <label><input type="checkbox" data-weight="3" /> Brak dostÄ™pu do pÃ³l przez operator []</label>
                    <label><input type="checkbox" data-weight="3" /> Brak dostÄ™pu do pÃ³l przez operator -></label>
                </td>
            </tr>

            <tr>
                <td>3. Rekurencyjne Zwalnianie â€“ 10 pkt</td>
                <td>
                    <label><input type="checkbox" data-weight="4" /> Funkcja czyszczÄ…ca listÄ™ jest rekurencyjna</label>
                    <label><input type="checkbox" data-weight="3" /> Usuwanie w kolejnoÅ›ci odwrotnej (od koÅ„ca)</label>
                    <label><input type="checkbox" data-weight="3" /> Komunikat "Usuwanie: [nazwa]" przed zwolnieniem</label>
                </td>
            </tr>

            <tr>
                <td>4. Callbacks (Funkcje wyÅ¼szego rzÄ™du) â€“ 5 pkt</td>
                <td>
                    <label><input type="checkbox" data-weight="2" /> Funkcja raportujÄ…ca przyjmujÄ…ca wskaÅºnik na funkcjÄ™</label>
                    <label><input type="checkbox" data-weight="1" /> PrzykÅ‚ad 1: Filtrowanie po kaloriach (>500)</label>
                    <label><input type="checkbox" data-weight="2" /> PrzykÅ‚ad 2: Filtrowanie po kategorii posiÅ‚ku</label>
                </td>
            </tr>

            <tr>
                <td>5. Idiomatyczny C++ â€“ 10 pkt</td>
                <td>
                    <label><input type="checkbox" data-weight="2" /> UÅ¼ycie std::vector zamiast surowych tablic</label>
                    <label><input type="checkbox" data-weight="2" /> ZarzÄ…dzanie pamiÄ™ciÄ…: unique_ptr / Å›wiadoma rezygnacja z dynamicznej alokacji</label>
                    <label><input type="checkbox" data-weight="2" /> Poprawne uÅ¼ycie const i referencji (&)</label>
                    <label><input type="checkbox" data-weight="2" /> Implementacja template dla funkcji wprowadzania danych</label>
                    <label><input type="checkbox" data-weight="2" /> Wykorzystanie std::function</label>
                </td>
            </tr>
        </table>
    </div>

    <div class="side-panel">
        <div class="penalty-section">
            <h3>Punkty ujemne</h3>
            <label><input type="checkbox" class="penalty" /> Kod nieczytelny / chaotyczny (âˆ’1)</label>

            <div class="strike-boxes">
                <label><input type="checkbox" class="strike" /> Strike 1</label>
                <label><input type="checkbox" class="strike" /> Strike 2</label>
                <label><input type="checkbox" class="strike" /> Strike 3</label>
            </div>
        </div>

        <div class="summary">
            <p class="total" id="totalScore">Suma punktÃ³w: 0 / 45</p>
            <p id="timer">Czas od ostatniego resetu: 00:00</p>
            <div class="buttons">
                <button id="copyHtml">ðŸ“‹ Kopiuj raport (Teams)</button>
                <button id="resetForm">ðŸ”„ Resetuj formularz</button>
            </div>
        </div>
    </div>
</main>

<script>
    const allBoxes = document.querySelectorAll("input[type='checkbox']");
    const scoreEl = document.getElementById("totalScore");
    const resetBtn = document.getElementById("resetForm");
    const strikeBoxes = document.querySelectorAll(".strike");

    function calculateStrikePenalty(count) {
        if (count === 1) return 2;
        if (count === 2) return 10;
        if (count === 3) return 40;
        return 0;
    }

    function updateLiveScore() {
        const positives = document.querySelectorAll("input[type='checkbox']:not(.penalty):not(.strike)");
        const penalties = document.querySelectorAll(".penalty");

        let total = 0;
        positives.forEach(c => {
            if (c.checked) {
                const weight = parseInt(c.dataset.weight || '1', 10);
                total += isNaN(weight) ? 1 : weight;
            }
        });

        let minus = 0;
        penalties.forEach(p => minus += p.checked ? 1 : 0);

        let strikeCount = 0;
        strikeBoxes.forEach(s => strikeCount += s.checked ? 1 : 0);

        minus += calculateStrikePenalty(strikeCount);
        const final = Math.max(total - minus, 0);
        scoreEl.innerText = `Suma punktÃ³w: ${final} / 45 (âˆ’${minus} pkt)`;
        unsavedChanges = true;
    }

    allBoxes.forEach(cb => cb.addEventListener("change", updateLiveScore));

    document.getElementById("copyHtml").addEventListener("click", () => {
        const rows = document.querySelectorAll("#pointsTable tr:not(:first-child)");
        let output = "=== Wynik oceny â€“ Dietetyczny Detektyw â€“ Etap II (C++) ===\n\n";

        rows.forEach(row => {
            const category = row.cells[0].innerText.trim();
            output += `**${category}**\n`;
            const checks = row.querySelectorAll("label");
            checks.forEach(lbl => {
                const cb = lbl.querySelector("input[type='checkbox']");
                const mark = cb && cb.checked ? "âœ”" : "âœ–";
                output += `${mark} ${lbl.textContent.trim().replace(/^[âœ”âœ–]\s*/, "")}\n`;
            });
            output += "\n";
        });

        const penalties = document.querySelectorAll(".penalty");
        let minus = 0;
        penalties.forEach(p => minus += p.checked ? 1 : 0);

        let strikeCount = 0;
        strikeBoxes.forEach(s => strikeCount += s.checked ? 1 : 0);
        const strikePenalty = calculateStrikePenalty(strikeCount);
        minus += strikePenalty;

        if (minus > 0) {
            output += "**Punkty ujemne:**\n";
            penalties.forEach(p => {
                if (p.checked) output += `âˆ’1 ${p.parentElement.textContent.trim()}\n`;
            });
            if (strikeCount > 0)
                output += `âˆ’${strikePenalty} (${strikeCount} Ã— strike)\n`;
            output += "\n";
        }
        output += scoreEl.innerText;

        navigator.clipboard
            .writeText(output)
            .then(() => alert("âœ” Raport skopiowany â€“ wklej do Teams (Ctrl+V)."))
            .catch(() => alert("âŒ Nie udaÅ‚o siÄ™ skopiowaÄ‡."));
    });

    // Licznik czasu (tylko minuty i sekundy, lokalny format)
    const timerEl = document.getElementById("timer");
    let timerStartTime = null;
    let timerInterval = null;

    function updateTimerDisplay() {
        if (!timerStartTime) return;

        const elapsedMs = Date.now() - timerStartTime;
        const elapsedDate = new Date(elapsedMs);
        const mm = String(Math.floor(elapsedMs / 60000)).padStart(2, '0');
        const ss = String(elapsedDate.getUTCSeconds()).padStart(2, '0');
        timerEl.innerText = `Czas od ostatniego resetu: ${mm}:${ss}`;
    }

    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerStartTime = Date.now();
        timerInterval = setInterval(updateTimerDisplay, 500);
        updateTimerDisplay();
    }

    // Reset formularza i start licznika (z potwierdzeniem)
    let unsavedChanges = false;
    resetBtn.addEventListener("click", () => {
        if (confirm("Czy na pewno chcesz zresetowaÄ‡ formularz?")) {
            document.querySelectorAll("input[type='checkbox']").forEach(cb => cb.checked = false);
            updateLiveScore();
            startTimer();
            unsavedChanges = false;
        }
    });

    // OstrzeÅ¼enie o niezapisanych zmianach
    window.addEventListener('beforeunload', (e) => {
        if (!unsavedChanges) return;
        e.preventDefault();
        e.returnValue = '';
    });

    // Inicjalizacja
    startTimer();
    updateLiveScore();
</script>
</body>
</html>
